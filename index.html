-<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RÃ¡dio Online</title>
<style>
  :root { --spotify-green:#043a18; --text:#ffffff; --accent:#0cdfb9; }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    width:100%;height:100vh;overflow:hidden;
    font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;
    color:var(--text);display:flex;align-items:center;justify-content:center;
    background-color:#000;
  }
  .background{
    position:fixed;inset:0;
    background-size:cover;
    background-position:center;
    z-index:-1;
    transition:opacity 0.8s ease-in-out;
  }
  .player-bar{
    position:fixed;bottom:0;left:0;width:100%;
    background:rgba(255,255,255,0.15);
    backdrop-filter:blur(10px) saturate(120%);
    display:flex;flex-direction:column;align-items:center;
    padding:25px 0;gap:15px;
  }
  .play-button{
    width:80px;height:80px;border-radius:50%;border:none;
    background-color:var(--spotify-green);color:#fff;font-size:40px;cursor:pointer;
    display:flex;align-items:center;justify-content:center;
    box-shadow:0 4px 25px rgba(4,58,24,0.4);
    transition:transform .2s ease,box-shadow .2s ease;
  }
  .play-button:hover{transform:scale(1.05);box-shadow:0 6px 28px rgba(4,58,24,0.6);}
  .equalizer{display:flex;align-items:flex-end;justify-content:center;height:25px;gap:4px;}
  .bar{width:4px;height:6px;background-color:var(--spotify-green);border-radius:2px;opacity:.8;transform-origin:bottom;}
  .playing .bar{animation:bounce 1s ease-in-out infinite;}
  .playing .bar:nth-child(2){animation-delay:.1s}
  .playing .bar:nth-child(3){animation-delay:.2s}
  .playing .bar:nth-child(4){animation-delay:.3s}
  @keyframes bounce{0%,100%{transform:scaleY(0.3)}50%{transform:scaleY(1.3)}}

  /* ðŸ’¬ Mini Chat */
  #chat-container {
    position: fixed;
    bottom: 230px; /* ðŸ”¹ mais acima, longe do player */
    left: 40px;
    width: 320px;
    max-height: 420px;
    display: flex; /* ðŸ”¹ jÃ¡ aberto */
    flex-direction: column;
    border-radius: 15px;
    overflow: hidden;
    backdrop-filter: blur(12px);
    background: rgba(4,58,24,0.96);
    border: 1px solid rgba(255,255,255,0.15);
    box-shadow: 0 0 20px rgba(4,58,24,0.7);
    z-index: 999;
    animation: fadeIn .4s ease;
  }
  @keyframes fadeIn {
    from {opacity:0; transform:translateY(20px);}
    to {opacity:1; transform:translateY(0);}
  }
  #chat-header {
    background: rgba(0,0,0,0.3);
    color: var(--accent);
    padding: 10px;
    font-weight: bold;
    text-align: center;
    font-size: 15px;
    letter-spacing: 1px;
    position: relative;
  }
  #minimize-chat {
    position: absolute;
    right: 10px;
    top: 5px;
    background: transparent;
    border: none;
    color: var(--accent);
    font-size: 18px;
    cursor: pointer;
  }
  #chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .msg {
    padding: 8px 10px;
    border-radius: 10px;
    max-width: 80%;
    word-wrap: break-word;
    animation: pop .3s ease;
  }
  @keyframes pop { from {opacity:0; transform:scale(0.9);} to {opacity:1; transform:scale(1);} }
  .msg.user {
    background: var(--accent);
    color:#000;
    align-self: flex-end;
    border-bottom-right-radius: 2px;
  }
  .msg.other {
    background:rgba(255,255,255,0.1);
    color:#fff;
    align-self: flex-start;
    border-bottom-left-radius: 2px;
  }
  #chat-input {
    display: flex;
    border-top: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.2);
  }
  #msgInput {
    flex: 1; padding: 8px; border: none; outline: none;
    background: transparent; color: #fff;
  }
  #sendBtn {
    background: var(--accent);
    border: none;
    color: #000;
    padding: 8px 12px;
    cursor: pointer;
    font-weight: bold;
  }

  @media (max-width:480px) {
    #chat-container {
      width: 90%;
      left: 5%;
      bottom: 200px;
    }
  }
</style>
</head>
<body>

<div id="bg" class="background"></div>

<div class="player-bar">
  <button id="playPause" class="play-button">â–¶</button>
  <div class="equalizer" id="equalizer">
    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
  </div>
</div>

<!-- ðŸ’¬ Mini Chat -->
<div id="chat-container">
  <div id="chat-header">
    Chat da RÃ¡dio
    <button id="minimize-chat">âˆ’</button>
  </div>
  <div id="chat-messages"></div>
  <div id="chat-input">
    <input id="msgInput" placeholder="Digite sua mensagem..." />
    <button id="sendBtn">âž¤</button>
  </div>
</div>

<audio id="audio" preload="metadata" src="https://stream.zeno.fm/l8ocj9i6ka2uv"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getDatabase, ref as dbRef, onValue, push } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAt4CeGjdbjzdtMH1qZHw6RuBFJ6SeTDKk",
  authDomain: "coletivo-f34d4.firebaseapp.com",
  databaseURL: "https://coletivo-f34d4-default-rtdb.firebaseio.com",
  projectId: "coletivo-f34d4",
  storageBucket: "coletivo-f34d4.firebasestorage.app",
  messagingSenderId: "296376447787",
  appId: "1:296376447787:web:1341c59c8087d6ac1e4b6e"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const infoRef = dbRef(db, "coletivo_info");

// ðŸŽµ RÃ¡dio
const bg = document.getElementById("bg");
const playPauseBtn = document.getElementById("playPause");
const equalizer = document.getElementById("equalizer");
const audio = document.getElementById("audio");

onValue(infoRef, (snap) => {
  const info = snap.val() || {};
  if (info.bg) bg.style.backgroundImage = `url('${info.bg}')`;
});

// ðŸŽ§ Play/pause
playPauseBtn.addEventListener("click", async () => {
  if (audio.paused) {
    await audio.play().catch(()=>{});
    playPauseBtn.innerHTML = "âšâš";
    equalizer.classList.add("playing");
  } else {
    audio.pause();
    playPauseBtn.innerHTML = "â–¶";
    equalizer.classList.remove("playing");
  }
});

// ðŸ’¬ Chat
const chatRef = dbRef(db, "chat_mensagens");
const chatMessages = document.getElementById("chat-messages");
const msgInput = document.getElementById("msgInput");
const sendBtn = document.getElementById("sendBtn");
const nomeUser = "Ouvido" + Math.floor(Math.random()*1000);

// enviar msg
sendBtn.onclick = () => {
  const msg = msgInput.value.trim();
  if (msg) {
    push(chatRef, { nome: nomeUser, texto: msg, ts: Date.now() });
    msgInput.value = "";
  }
};

// receber msgs
onValue(chatRef, (snap) => {
  chatMessages.innerHTML = "";
  const data = snap.val() || {};
  Object.values(data).forEach(m => {
    const div = document.createElement("div");
    div.className = "msg " + (m.nome === nomeUser ? "user" : "other");
    div.textContent = `${m.nome === nomeUser ? "VocÃª" : m.nome}: ${m.texto}`;
    chatMessages.appendChild(div);
  });
  chatMessages.scrollTop = chatMessages.scrollHeight;
});

// msg de boas-vindas
window.addEventListener("load", () => {
  const welcome = document.createElement("div");
  welcome.className = "msg other";
  welcome.textContent = "ðŸŽ¶ Bem-vindo(a) Ã  RÃ¡dio Online! Converse conosco ao vivo.";
  chatMessages.appendChild(welcome);
});
</script>
</body>
</html>
